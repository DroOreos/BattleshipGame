

import java.util.Scanner;

/**
 * Represents a human player in the Battleship game.
 */
public class HumanPlayer extends AbstractPlayer {

	private Scanner input = new Scanner(System.in);
	private int num_shipsSunk;
	public int[] lengthOfShip = {5,4,3,3,2};

	/**
	 * Constructor
	 */
	public HumanPlayer(String name) {
		super(name);
		num_shipsSunk = 0;

	}

	public void addShip(int x, int y, boolean orientation,int length) {
		if(isValid(x,y,length,orientation)) {
			GridCell[] arrForShip = new GridCell[length];
			if(orientation) {
				for(int i =0; i<length;i++) {
					GridCell cell =	game.getGridCell(x+i,y);
					if(cell.getState()==GridCell.CellState.SHIP) 
						break;
	
					cell.setState(GridCell.CellState.SHIP);
					cell = arrForShip[x+i];
					
				}
				ship newShip = new ship(arrForShip);
				shipArr[num_shipsAlive]=newShip;
				num_shipsAlive++;
			}
			else {
				for(int i =0; i<length;i++) {
					GridCell cell =	game.getGridCell(x,y+i);
					if(cell.getState()==GridCell.CellState.SHIP) 
						break;
					
					cell.setState(GridCell.CellState.SHIP);
					cell = arrForShip[x+i];
					
				}
				ship newShip = new ship(arrForShip);
				shipArr[num_shipsAlive]=newShip;
				num_shipsAlive++;
				
			}
		}	
	}
	private boolean isValid(int x, int y,int length,boolean orientation) {
		// TODO Auto-generated method stub
		if(orientation) {
			if(x+length>=10)
				return false;
							
		}
					
		else {
			if (y+length>=10)
				return false;
		}
		
		return true;
	}




	/**
	 * Place the ships for the GUI version.
	 */
	@Override
	public void placeShips(Gameboard game) {
		this.updateStatusOfBoard(game);
		
		
	}
	
	/**
	 * Places the ships on the game board by getting valid locations from the user.
	 * @param playerBoard 
	 */
	public void placeShipsConsole(Gameboard playerBoard) {
		this.updateStatusOfBoard(playerBoard);
		int i = 1;
		for (Ship ship : ships) {
            boolean validLocation = false;
            while (!validLocation) {
            		
            	System.out.println("Place Ship# " + i);

                int row = getValidRowInput();
                int col = getValidColumnInput();
                boolean horizontal = getHorizontalInput();
                
                //if successfully placed ships, exit the while loop
                validLocation = game.placeShip(row, col, ship.length, horizontal);
                
                if( !validLocation ) {
                	System.out.println("Invalid Input.");
                }

            } i++;
        }
	}

	/**
	 * Makes a move on the game board in the GUI version of the game.
	 *
	 * @param game_status The current game board status.
	 */
	@Override
	public void makeMoveGUI() {
		//super.updateOpponentBoard(game_status);

	}

	
	/**
	 * Makes a move on the game board in the console version of the game.
	 *
	 * @param r           The row number of the target location.
	 * @param c           The column number of the target location.
	 * @param game_status The current game board status.
	 */
	@Override
	public void makeMoveConsole(int r, int c) {
		//super.updateOpponentBoard(game_status);

		opponent_game.shoot(r,c);

	}
	
	/**
	 * Gets the number of ships the human player has remaining.
	 *
	 * @return The number of ships remaining.
	 */
	@Override
	public int getNumShips() {
		return super.num_shipsAlive;
	}

	/**
	 * Checks if the human player has won the game.
	 *
	 * @return True if all of the human player's ships are sunk, false otherwise.
	 */
	@Override
	public boolean hasWon() {
		return num_shipsSunk == ships.length;
	}

	
	public int getShipsSunked() {
		return this.num_shipsSunk;
	}

	/**
	 * Gets the number of ships sunk by the human player.
	 *
	 * @return The number of ships sunk.
	 */
	public void setShipsSunked(int s) {
		this.num_shipsSunk = s;
	}



	

	/**
	 * Helper function for Place_ships(): get a valid row (A-J)
	 * 
	 * @return row
	 */
	private int getValidRowInput() {
		boolean valid = false;
		System.out.print("Enter row: (A-J): ");
		int row = -1;

		while (!valid) {

			try {
				String r_str = input.next();
				char rowChar = r_str.toUpperCase().charAt(0);

				row = rowChar - 'A';
				if (row >= 0 && row <= 9) {
					valid = true;
				} else
					System.out.print("Try Again. Enter Row: (A-J):");

			} catch (Exception e) {
				System.out.println("Invalid input. Please enter a valid row (A-J).");
			}
		}

		return row;
	}

	/**
	 * Helper function for Place_ships(): get a valid row integer (0-9)
	 * 
	 * @return column
	 */
	private int getValidColumnInput() {
		boolean validInput = false;
		int col = -1;
		System.out.print("Enter column: (0-9): ");

		// makes sure it is an integer.
		while (!validInput) {
			try {
				col = input.nextInt();
				if (col >= 0 && col <= 9) {
					validInput = true;
				} else
					System.out.print("Try Again. Enter column: (0-9):");
			} catch (Exception e) {
				input.nextLine();
				System.out.println("ERROR:Invalid input. Enter column: (0-9):");
			}
		}
		return col;
	}

	/**
	 * Helper function for placeShips(): get a valid boolean that tells us if it is
	 * horizontal.
	 * 
	 * @return boolean
	 */
	private boolean getHorizontalInput() {
		boolean validInput = false;
		System.out.print("Horizontal or Vertical? (H for horizontal, V for vertical) ");
		String placement = null;

		while (!validInput) {
			try {
				placement = input.next().toUpperCase();
				if (placement.equals("H") || placement.equals("V")) {
					validInput = true;
				} else
					System.out.print("Try Again. Horizontal or Vertical? (H for horizontal, V for vertical) ");

			} catch (Exception e) {
				input.nextLine();
				System.out.println("Invalid input. Please enter H or V :.");
			}
		}

		return placement.toUpperCase().equals("H");
	}

	@Override
	public void updateAllGameboards(Gameboard a, Gameboard b) {
		this.player_board = a;
		this.opponent_board = b;
	}

	
}
